{% extends "layout.html" %}
{% block title %}Class Schedule – Likhil Education LMS{% endblock %}

{% block content %}
  <div class="container py-3">
    <h2 class="mb-4"><i class="fa-solid fa-calendar-days me-2"></i> Class Schedule</h2>

    <!-- Schedule a New Class -->
    <div class="card shadow-sm mb-4 border-0 rounded-3">
      <div class="card-header text-white" style="background: linear-gradient(90deg,#3f51b5,#5a55ae);">
        <i class="fa-solid fa-plus-circle me-1"></i> Schedule a New Class
      </div>
      <div class="card-body">
        <form method="POST" class="row g-3">
          <!-- Student -->
          <div class="col-md-4">
            <label class="form-label">Student</label>
            <select name="student" class="form-select shadow-sm" required>
              <option value="">— select student —</option>
              {% for s in students %}
                <option value="{{ s }}" {% if request.form.get('student') == s %}selected{% endif %}>{{ s }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Course -->
          <div class="col-md-4">
            <label class="form-label">Course</label>
            <select name="course" class="form-select shadow-sm" required>
              {% for c in custom_courses %}
                <option value="{{ c }}">{{ c }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Date -->
          <div class="col-md-4">
            <label class="form-label">Date</label>
            <input type="date" name="date" class="form-control shadow-sm" required />
          </div>
          <div class="col-md-4">
            <label class="form-label">End Date</label>
            <input type="date" name="end_date" class="form-control shadow-sm"
            value="{{ request.form.get('end_date','') }}" required />
          </div>


          <!-- Start time -->
          <div class="col-md-4">
            <label class="form-label">Start Time</label>
            <input type="time" name="time" class="form-control shadow-sm" required />
          </div>

          <!-- End time -->
          <div class="col-md-4">
            <label class="form-label">End Time</label>
            <input type="time" name="end_time" class="form-control shadow-sm"
                   value="{{ request.form.get('end_time','') }}" required />
          </div>

          <!-- Duration -->
          <div>
  <label class="form-label">Duration (hours)</label>
  <input type="number" 
         name="duration" 
         class="form-control shadow-sm"
         step="0.1" 
         min="0" 
         value="1" />
</div>


          <div class="col-12">
            <button type="submit" class="btn btn-primary shadow-sm">
              <i class="fa-solid fa-paper-plane me-1"></i> Schedule Class
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Upcoming Scheduled Classes -->
    {% if schedule_data %}
      <h4 class="mt-4"><i class="fa-solid fa-list-check me-2"></i> Upcoming Scheduled Classes</h4>
      <div class="card shadow-sm border-0 rounded-3">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-dark">
              <tr>
                <th>Student</th>
                <th>Course</th>
                <th>Date</th>
                <th>End Date</th> 
                <th>Start Time</th>
                <th>End Time</th>
                <th>Duration</th>
                <th>Join</th>
                <th class="text-center" style="width: 180px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for row in schedule_data %}
                {% set student = row.get('name') or row.get('Student') %}
                {% set course  = row.get('course') or row.get('Course') %}
                {% set date    = row.get('date') or row.get('Date') %}
                {% set end_date = row.get('end_date') or row.get('End Date') %}
                
                {% set start_t = row.get('start_time') or row.get('Time') %}
                {% set end_t   = row.get('end_time') or row.get('End Time') %}
                {% set dur     = row.get('duration') or row.get('Duration') %}
                <tr>
                  <td>{{ student }}</td>
                  <td>{{ course }}</td>
                  <td>{{ date }}</td>
                  <td>{{end_date }}</td>
                  <td>{{ start_t }}</td>
                  <td>{{ end_t }}</td>
                  <td>{{ dur }}</td>
                  
                  <!-- Join -->
                  <td>
                    {% if row.get('meet_url') %}
                      <a class="btn btn-primary btn-sm shadow-sm"
                         href="{{ row.get('meet_url') }}"
                         target="_blank" rel="noopener">
                        <i class="fa-solid fa-video me-1"></i> Join
                      </a>
                    {% else %}
                      <span class="text-muted">—</span>
                    {% endif %}
                  </td>

                  <!-- Actions -->
                  <td class="text-center">
                    <div class="d-inline-flex">
                      <form action="{{ url_for('delete_schedule', row_index=loop.index0) }}"
                            method="post" class="me-2"
                            onsubmit="return confirm('Delete this class?');">
                        <button type="submit" class="btn btn-danger btn-sm shadow-sm">
                          <i class="fa-solid fa-trash"></i>
                        </button>
                      </form>

                      <a href="{{ url_for('finish_schedule', index=loop.index0) }}"
                         class="btn btn-success btn-sm shadow-sm"
                         onclick="return confirm('Finish this class and move to attendance?');">
                        <i class="fa-solid fa-check"></i>
                      </a>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    {% else %}
      <div class="alert alert-info mt-3">No classes scheduled yet.</div>
    {% endif %}

    <!-- Calendar -->
    <h4 class="mt-5"><i class="fa-solid fa-calendar-alt me-2"></i> Calendar</h4>
    <div class="card shadow-sm border-0 rounded-3">
      <div class="card-body p-0">
        <iframe
          src="https://calendar.google.com/calendar/embed?src=guptaakash134%40gmail.com&ctz=Asia%2FKolkata"
          style="border:0" width="100%" height="600" frameborder="0" scrolling="no">
        </iframe>
      </div>
    </div>
  </div>
{% endblock %}



