<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Likhil LMS â€“ Class Schedule</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
    <a class="navbar-brand" href="#">Likhil LMS</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('dashboard') }}">Students</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('attendance') }}">Attendance</a></li>
        <li class="nav-item"><a class="nav-link active" href="{{ url_for('schedule') }}">Class Schedule</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Homework Status</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('payment_records') }}">Payment Records</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('payment_status') }}">Payment Status</a></li>
      </ul>
      <div class="d-flex">
        <a href="{{ url_for('logout') }}" class="btn btn-outline-light btn-sm">Logout</a>
      </div>
    </div>
  </nav>

  <div class="container py-4">
    <h2 class="mb-4">ðŸ“… Class Schedule</h2>

    <!-- Schedule a New Class -->
    <div class="card mb-4">
      <div class="card-header">Schedule a New Class</div>
      <div class="card-body">
        <form method="POST" class="row g-3">
          <!-- Student -->
          <div class="col-md-4">
            <label class="form-label">Student</label>
            <select name="student" class="form-select" required>
  <option value="">â€” select student â€”</option>
  {% for s in students %}
    <option value="{{ s }}" {% if request.form.get('student') == s %}selected{% endif %}>{{ s }}</option>
  {% endfor %}
</select>

          </div>

          <!-- Course -->
          <div class="col-md-4">
            <label class="form-label">Course</label>
            <select name="course" class="form-select" required>
              {% for c in custom_courses %}
                <option value="{{ c }}">{{ c }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Date -->
          <div class="col-md-4">
            <label class="form-label">Date</label>
            <input type="date" name="date" class="form-control" required />
          </div>

          <!-- Start time -->
          <div class="col-md-4">
            <label class="form-label">Start Time</label>
            <input type="time" name="time" class="form-control" required />
          </div>

          <!-- End time -->
          <div class="col-md-4">
            <label class="form-label">End Time</label>
            <input type="time" name="end_time" class="form-control"
                   value="{{ request.form.get('end_time','') }}" required />
          </div>

          <!-- Duration -->
          <div class="col-md-4">
            <label class="form-label">Duration (hours)</label>
            <input type="number" name="duration" class="form-control" min="1" step="0.5" value="1" required />
          </div>

          <div class="col-12">
            <button type="submit" class="btn btn-primary">Schedule Class</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Upcoming Scheduled Classes -->
    {% if schedule_data %}
      <h4 class="mt-4">ðŸ“ƒ Upcoming Scheduled Classes</h4>
      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Student</th>
              <th>Course</th>
              <th>Date</th>
              <th>Start Time</th>
              <th>End Time</th>
              <th>Duration</th>
              <th> Join</th>
              <th class="text-center" style="width: 180px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for row in schedule_data %}
              {# handle both new and old key styles #}
              {% set student = row.get('name') or row.get('Student') %}
              {% set course  = row.get('course') or row.get('Course') %}
              {% set date    = row.get('date') or row.get('Date') %}
              {% set start_t = row.get('start_time') or row.get('Time') %}
              {% set end_t   = row.get('end_time') or row.get('End Time') %}
              {% set dur     = row.get('duration') or row.get('Duration') %}
              <tr>
  <td>{{ student }}</td>
  <td>{{ course }}</td>
  <td>{{ date }}</td>
  <td>{{ start_t }}</td>
  <td>{{ end_t }}</td>
  <td>{{ dur }}</td>
  
  <!-- Join button -->
  <td>
    {% if row.get('meet_url') %}
      <a class="btn btn-primary btn-sm"
         href="{{ row.get('meet_url') }}"
         target="_blank" rel="noopener">
         Join Class
      </a>
    {% else %}
      <span class="text-muted">â€”</span>
    {% endif %}
  </td>

  <!-- Actions -->
  <td class="text-center">
    <div class="d-inline-flex">
      <!-- Delete -->
      <form action="{{ url_for('delete_schedule', row_index=loop.index0) }}"
            method="post" class="me-2"
            onsubmit="return confirm('Delete this class?');">
        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
      </form>

      <!-- Finish -->
      <a href="{{ url_for('finish_schedule', index=loop.index0) }}"
         class="btn btn-success btn-sm"
         onclick="return confirm('Finish this class and move to attendance?');">
        Finish
      </a>
    </div>
  </td>
</tr>

            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-info">No classes scheduled yet.</div>
    {% endif %}

    <!-- Calendar -->
    <h4 class="mt-5">ðŸ“† Calendar</h4>
    <div class="card mb-4">
      <div class="card-body p-0">
        <iframe
          src="https://calendar.google.com/calendar/embed?src=guptaakash134%40gmail.com&ctz=Asia%2FKolkata"
          style="border:0" width="100%" height="600" frameborder="0" scrolling="no">
        </iframe>
      </div>
    </div>
  </div>
</body>
</html>


